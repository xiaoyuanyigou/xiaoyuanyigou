<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>个人资料</title>
    <meta name="keywords">
    <meta name="description">

    <link rel="shortcut icon" href="favicon.ico"> <link href="__PUBLIC__/admin_css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="__PUBLIC__/admin_css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="__PUBLIC__/admin_css/animate.css" rel="stylesheet">
    <link href="__PUBLIC__/admin_css/style.css?v=4.1.0" rel="stylesheet">



</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeIn">

    <div class="row">
        <div class="col-sm-12">
            <div class="tabs-container">

                <ul class="nav nav-tabs" id='myTab'>
                    <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true"> 基本资料</a>
                    </li>
                    <li class=""><a data-toggle="tab" href="#tab-2" aria-expanded="false">修改头像</a>
                    </li>
                    <li class=""><a data-toggle="tab" href="#tab-3" aria-expanded="false">修改密码</a>
                    </li>
                </ul>
                <div class="tab-content">
                <!--基本信息修改-->
                    <div id="tab-1" class="tab-pane active">
                        <div class="panel-body">
                        <div class="ibox-content">
                        <form class="form-horizontal m-t" id="commentForm"  action="">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">头像：</label>
                                <div class="col-sm-8">
                                    <img src="" id='headImg' class="img-circle" alt="头像" style="margin-left:20px;width:100px;height:100px">
                                </div>
                            </div>
                            <div class="form-group">
                              <label class="col-sm-3 control-label">微信头像和昵称</label>
                              <div class="col-sm-8">
                                  <p class="form-control-static">
                                    <a href="javascript:;" style="color:black;"><img alt="image" src="__PUBLIC__/images/pro2.png" style="width:60px;height:60px;border-radius:10px;">&nbsp;&nbsp;八级大狂风</a>
                                  </p>
                                  <!-- <a class="btn btn-w-m btn-primary" href="../Merchant/bindWx">立即绑定微信</a> -->
                              </div>
                          </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">姓名：</label>
                                <div class="col-sm-8">
                                    <input id="cname" name="name" minlength="2" type="text" class="form-control" required="" aria-required="true" value=''>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-3 control-label">E-mail：</label>
                                <div class="col-sm-8">
                                    <input id="cemail" type="email" class="form-control" name="email" required="" aria-required="true" value=''>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">电话 ：</label>
                                <div class="col-sm-8">
                                    <input id="ctel" type="tel" class="form-control" name="tel" value=''>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-3">
                                    <button class="btn btn-primary" type="submit" value='' onclick="edit('{:session(\'username\')}')">保存</button>
                                </div>
                            </div>
                        </form>
                    </div>
                        </div>
                    </div>
                    <!--头像修改-->
                    <div id="tab-2" class="tab-pane">
                       <div class="form-group">
                          <label class="col-sm-1 control-label" style='font-size:0.65em'>当前头像:</label>
                          <img class="col-sm-3" src='' id='cur_img' width='350px' height='300px'>
                         <div class='col-sm-8'>
                          <p id="swfContainer">
                          本组件需要安装Flash Player后才可使用，请从<a href="http://www.adobe.com/go/getflashplayer">这里</a>下载安装。
                          </p>
                          </div>

                       </div>
                    </div>
                    <!--密码修改-->
                    <div id="tab-3" class="tab-pane">

                       <form class="form-horizontal m-t" id="signupForm">

                            <div class="form-group">
                                <label class="col-sm-3 control-label">新密码：</label>
                                <div class="col-sm-8">
                                    <input id="password" name="password" class="form-control" type="password">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">确认密码：</label>
                                <div class="col-sm-8">
                                    <input id="confirm_password" name="confirm_password" class="form-control" type="password">
                                    <span class="help-block m-b-none"><i class="fa fa-info-circle"></i> 请再次输入您的密码</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-3">
                                    <button class="btn btn-primary" type="submit" value=''   onclick="edit('{:session(\'username\')}')">保存</button>
                                </div>
                            </div>
                       </form>


                    </div>
                </div>


            </div>
        </div>


    </div>
   </div>


    <!-- 全局js -->

    <script src="__PUBLIC__/admin_js/jquery.min.js?v=2.1.4"></script>
    <script src="__PUBLIC__/admin_js/bootstrap.min.js?v=3.3.6"></script>
    <script src="__PUBLIC__/admin_js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="__PUBLIC__/admin_js/plugins/layer/layer.min.js"></script>
    <!--表单验证-->
     <script src="__PUBLIC__/admin_js/plugins/validate/jquery.validate.min.js"></script>
    <script src="__PUBLIC__/admin_js/plugins/validate/messages_zh.min.js"></script>

    <script src="__PUBLIC__/admin_js/form-validate-demo.js"></script>
    <!-- 自定义js -->
    <script src="__PUBLIC__/admin_js/content.js?v=1.0.0"></script>

    <!--上传头像-->
    <script type="text/javascript" src="__PUBLIC__/Uploadify/swfobject.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Uploadify/fullAvatarEditor.js"></script>
    <script type="text/javascript">
    var PUBLIC = '__PUBLIC__';
    var uploadUrl = '{:U("User/uploadFace")}';
    var username="{:session('username')}";

    $(document).ready(function(){

      //点击首页的头像，跳转到第二个选项卡，修改头像
      $.getUrlParam = function(name) {
　　　　var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
　　　　var r = window.location.search.substr(1).match(reg);
　　　　if(r != null) return unescape(r[2]);
　　　　return null;
　　 }
　　 var url_status = $.getUrlParam('process');
     if(url_status==2){
         $('#myTab li:eq(1) a').tab('show');
         //$('#myTab a[href="#tab-2"]').tab('show')
      }
      /**
       * [description]获取数据赋值到前端
       * @Author   WangShuo
       * @DateTime 2017-07-19T07:49:06+0800
       * @param    {[type]}                 data){                          var obj [description]
       * @return   {[type]}                         [description]
       */
      $.post(
         "{:U('User/userinfo')}" ,
         {},
         function(data){
             var obj=eval("("+data+")") ;
             //alert(data);

             var item=obj.data;
             //alert('__PUBLIC__/'+item.image_path);
           document.getElementById('headImg').src='__ROOT__/'+item.image_path;
           document.getElementById('cname').value=item.username;
           document.getElementById("cemail").value=item.email;
           document.getElementById("ctel").value=item.tel;
           //alert('__ROOT__/'+item.image_path);
           document.getElementById('cur_img').src='__ROOT__/'+item.image_path;
})

        //头像上传 插件
        swfobject.addDomLoadEvent(function () {
                //以下两行代码正式环境下请删除
                //if(location.href.indexOf('http://height("")') == -1)
                //alert('请于WEB服务器环境中查看、测试！\n\n既 http://*/simpleDemo.html\n\n而不是本地路径 file:///*/simpleDemo.html的方式');
                var swf = new fullAvatarEditor("__PUBLIC__/Uploadify/fullAvatarEditor.swf", "__PUBLIC__/Uploadify/expressInstall.swf", "swfContainer", {
                        id : 'swf',
                        upload_url : "{:U('User/uploadImg')}",   //上传接口
                        method : 'get', //传递到上传接口中的查询参数的提交方式。更改该值时，请注意更改上传接口中的查询参数的接收方式
                        src_upload : 2,     //是否上传原图片的选项，有以下值：0-不上传；1-上传；2-显示复选框由用户选择
                        avatar_box_border_width : 0,
                        tab_visible: false,//是否显示选项卡*
                        src_size: "2MB",//选择的本地图片文件所允许的最大值，必须带单位，如888Byte，88KB，8MB
                        src_size_over_limit: "文件大小超出2MB，请重新选择图片。",//当选择的原图片文件的大小超出指定最大值时的提示文本。可使用占位符{0}表示选择的原图片文件的大小。
                        avatar_sizes : '200*250',//100*100|50*50|32*32,表示一组或多组头像的尺寸。其间用"|"号分隔。
                        avatar_sizes_desc : '200*250',
                        avatar_tools_visible : false,
                        checkbox_visible : false
                    }, function (msg) {
                           switch (msg.code) {
                    // case 1: alert("页面成功加载了组件！"); break;
                    // case 2: alert("已成功加载默认指定的图片到编辑面板。"); break;
                        case 3:
                          if (msg.type == 0) {
                            alert("摄像头已准备就绪且用户已允许使用。");
                          }
                         else if (msg.type == 1) {
                            alert("摄像头已准备就绪但用户未允许使用！");
                        }
                        else {
                            alert("摄像头被占用！");
                        }
                        break;
                       case 5:
                       //alert(msg.type);
                       if(msg.type==0){
                        alert('操作成功！');
                        //alert('__ROOT__');
                        document.getElementById("cur_img").src="__ROOT__/"+msg.content.img;
                        $('#adminImg', window.parent.document).attr('src',"__ROOT__/"+msg.content.img);//修改左侧菜单栏的头像
                       }
                }


                 }
                );


            });


     //修改基本信息

    function edit(usrername){

      var email=$("#cemail").val();
      var tel=$("#ctel").val();

      var confirm_password=$("#confirm_password").val();
     // alert(email+'///'+tel);
      $.ajax({
        url:"{:U('User/editUser')}",
        type:'post',
        data:{username:usrername,email:email,tel:tel,password:confirm_password},
        success:function(data){
            //alert(data);
            var obj=eval("("+data+")");
            alert(obj.data.msg);
            /*document.getElementById('cname').value=obj.data.username;
            document.getElementById("cemail").value=obj.data.email;
            document.getElementById("ctel").value=obj.data.tel;
*/


        }
       })
     }


})
    </script>
</body>

</html>
